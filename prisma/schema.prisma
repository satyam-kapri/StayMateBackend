// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- User & Authentication ---
model User {
  id                String            @id @default(uuid())
  phone             String            @unique 
  firebaseUid       String            @unique // Integration with Firebase Auth
  isVerified        Boolean           @default(false) 
  premiumStatus     PremiumStatus     @default(FREE)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  status            VerificationStatus @default(PENDING)
  // Profile Relations
  profile           Profile? 
  
  // Interaction Relations
  sentMatches       Match[]           @relation("MatchesSent")
  receivedMatches   Match[]           @relation("MatchesReceived")
  
 chatsAsUser1 Chat[] @relation("ChatUser1")
 chatsAsUser2 Chat[] @relation("ChatUser2")
 sentMessages Message[]

 kyc KYCDocument?
}

// ---  Profile & Lifestyle Survey ---
model Profile {
  id                String            @id @default(uuid())
  userId            String            @unique
  user              User              @relation(fields: [userId], references: [id])
  
  // Basic Info 
  name              String
  age               Int
  gender            Gender
  occupation        String?           // e.g., "Student/Designer"
  bio               String?           @db.VarChar(500)

  // Preferences & Location
  budgetMin         Float
  budgetMax         Float
  preferredAreas    Location[]       
  moveInDate        DateTime?
  
  // Media 
  photos            Photo[]
  
  questionResponses QuestionResponse[]

  currentStep       Int            @default(0)        
  lastSeen          DateTime?
}
model QuestionCategory {
  id          String    @id @default(uuid())
  name        String    // Only "Lifestyle Survey" now
  description String?
  order       Int
  questions   Question[]
  
  @@unique([name])
}

model Question {
  id          String    @id @default(uuid())
  categoryId  String
  category    QuestionCategory @relation(fields: [categoryId], references: [id])
  text        String
  type        QuestionType
  options     Option[]
  order       Int
  isActive    Boolean   @default(true)
  required    Boolean   @default(false)
  weight      Float     @default(1.0)  // Weight for matching
  
  questionResponses QuestionResponse[]
  
  @@unique([categoryId, order])
}

model Option {
  id         String   @id @default(uuid())
  questionId String
  question   Question @relation(fields: [questionId], references: [id])
  
  text       String
  value      String
  order      Int
  
  @@unique([questionId, order])
}

model QuestionResponse {
  id         String   @id @default(uuid())
  profileId  String
  questionId String
  profile    Profile  @relation(fields: [profileId], references: [id])
  question   Question @relation(fields: [questionId], references: [id])
  
  textValue    String?
  numberValue  Float?
  dateValue    DateTime?
  selectedOptions String[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([profileId, questionId])
}

enum QuestionType {
  RADIO
  MULTI_SELECT
  TEXT
  NUMBER
  DATE
}
model Photo {
  id        String   @id @default(uuid())
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id])
  url       String   
  order     Int      @default(0) // For carousel order 
}


// ---  AI Compatibility & Matching ---
model Match {
  id                String            @id @default(uuid())
  requesterId       String
  receiverId        String
  requester         User              @relation("MatchesSent", fields: [requesterId], references: [id])
  receiver          User              @relation("MatchesReceived", fields: [receiverId], references: [id])
  
  compatibilityScore Int              // Rule-based % 
  status            MatchStatus       @default(PENDING) // PENDING, CONNECTED, SKIPPED
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@unique([requesterId, receiverId])
}


model Chat {
  id        String   @id @default(uuid())
  user1Id   String
  user2Id   String
  user1     User     @relation("ChatUser1", fields: [user1Id], references: [id])
  user2     User     @relation("ChatUser2", fields: [user2Id], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  messages  Message[]
  
  @@unique([user1Id, user2Id])
}
model Message {
  id        String   @id @default(uuid())
  chatId    String
  chat      Chat     @relation(fields: [chatId], references: [id])
  senderId  String
  sender    User     @relation(fields: [senderId], references: [id])
  content   String
  read      Boolean  @default(false)
  readAt    DateTime?
  isAdminMessage Boolean?
  createdAt DateTime @default(now())
  
  @@index([chatId, createdAt])
}
model KYCDocument {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id])
  
  // Simple fields
  idType          IdType
  idFrontUrl      String
  idBackUrl       String?
  selfieUrl       String
  
  // Status
  status          VerificationStatus @default(PENDING)
  step            Int @default(0)
  rejectionReason String?
  
  // Timestamps
  submittedAt     DateTime @default(now())
  reviewedAt      DateTime?
  reviewerId      String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
  @@index([status])
}// --- Enums ---
enum Gender {
  MALE
  FEMALE
  OTHER
}
enum IdType{
  AADHAAR
  PAN
  DRIVING_LICENSE
}
enum PremiumStatus {
  FREE
  PREMIUM
}

enum VerificationStatus {
  PENDING
  VERIFIED
  FLAGGED
}

enum MatchStatus {
  PENDING
  CONNECTED // Mutual Connect 
  SKIPPED
}
enum PreferenceLevel {
  NO
  SOMETIMES
  YES
}
enum Areas{
  Delhi
  Gurugram
  Noida
  Greater_Noida
}
model Location {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}